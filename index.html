<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Form Penggunaan Kendaraan BRIN â€“ Offline + TTD</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f8f9fa;margin:0;padding:0;color:#111}
  .wrapper{max-width:960px;margin:20px auto;padding:15px}
  .card{background:#fff;border:1px solid #ccc;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.05);padding:20px}
  .header{display:flex;gap:12px;align-items:center;margin-bottom:10px;border-bottom:2px solid #000;padding-bottom:10px}
  .header img{width:80px;height:80px;object-fit:contain}
  .titles h1{margin:0;font-size:20px}
  .titles p{margin:2px 0 0 0;font-size:13px;color:#555}
  label{font-size:13px;margin:6px 0;display:block}
  input,textarea,select{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;font-size:14px}
  textarea{min-height:70px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  .full{grid-column:1/-1}
  .hidden{display:none}
  .sig{border:1px solid #aaa;padding:8px;border-radius:6px;background:#fafafa}
  .sig h4{margin:4px 0;font-size:14px}
  canvas{width:100%;height:120px;border:1px solid #ccc;border-radius:6px;background:#fff}
  .sig-controls{margin-top:6px;display:flex;gap:6px;flex-wrap:wrap}
  button{padding:8px 12px;border-radius:6px;border:1px solid #ccc;background:#eee;cursor:pointer}
  button.primary{background:#c00000;color:#fff;border-color:#a00000}
  button.warn{background:#fff0f0;color:#900;border-color:#f5c2c7}
  .actions{margin-top:15px;display:flex;flex-wrap:wrap;gap:10px;justify-content:flex-end}
  @media print{.actions{display:none}body{background:#fff}.card{box-shadow:none;border:none}}
</style>
</head>
<body>
<div class="wrapper">
  <div class="card">
    <div class="header">
      <img src="logo_brin.png" alt="Logo BRIN">
      <div class="titles">
        <h1>Formulir Penggunaan Kendaraan Dinas BRIN</h1>
        <p>Biro Komunikasi Publikasi Umum dan Kesekretariatan</p>
      </div>
    </div>

    <div class="row">
      <div><label>Nama</label><input name="nama"></div>
      <div><label>NIP</label><input name="nip"></div>
      <div><label>Unit Kerja</label><input name="unit"></div>
      <div><label>Kontak</label><input name="kontak"></div>
    </div>

    <div class="row">
      <div><label>Jenis Kendaraan/Merk</label><input name="jenis"></div>
      <div><label>No. Polisi</label><input name="nopol"></div>
    </div>

    <div class="row">
      <div class="full"><label>Keperluan</label><textarea name="keperluan"></textarea></div>
    </div>

    <div class="row">
      <div><label>Tujuan</label><input name="tujuan"></div>
      <div>
        <label>Pengemudi</label>
        <select name="driver" id="driver">
          <option value="">Pilih</option>
          <option value="Dengan Pengemudi">Dengan Pengemudi</option>
          <option value="Tanpa Pengemudi">Tanpa Pengemudi</option>
        </select>
      </div>
      <div id="driverNameWrap" class="full hidden">
        <label>Nama Pengemudi</label>
        <input name="nama_pengemudi" id="nama_pengemudi" placeholder="Nama pengemudi">
      </div>
    </div>

    <div class="row">
      <div><label>Tanggal Pakai</label><input type="date" name="tgl_pakai"></div>
      <div><label>Jam Pakai</label><input type="time" name="jam_pakai"></div>
      <div><label>Tanggal Kembali</label><input type="date" name="tgl_kembali"></div>
      <div><label>Jam Kembali</label><input type="time" name="jam_kembali"></div>
    </div>

    <h3>Tanda Tangan</h3>
    <div class="row-3">
      <div class="sig">
        <h4>Peminjam</h4>
        <canvas id="sig_peminjam"></canvas>
        <div class="sig-controls">
          <input name="peminjam_nama" placeholder="Nama">
          <button type="button" data-clear="sig_peminjam" class="warn">Reset</button>
        </div>
      </div>
      <div class="sig">
        <h4>PIC/Pengemudi</h4>
        <canvas id="sig_pic"></canvas>
        <div class="sig-controls">
          <input name="pic_nama" placeholder="Nama">
          <button type="button" data-clear="sig_pic" class="warn">Reset</button>
        </div>
      </div>
      <div class="sig">
        <h4>Mengetahui</h4>
        <canvas id="sig_mengetahui"></canvas>
        <div class="sig-controls">
          <input name="mengetahui_nama" placeholder="Nama">
          <button type="button" data-clear="sig_mengetahui" class="warn">Reset</button>
        </div>
      </div>
    </div>

    <div class="actions">
      <button type="button" id="btnSimpan">Simpan</button>
      <button type="button" id="btnMuat">Muat</button>
      <button type="button" id="btnBersihkan" class="warn">Bersihkan</button>
      <button type="button" id="btnPDF" class="primary">Cetak PDF</button>
    </div>
  </div>
</div>

<script>
const storageKey='Form_Kendaraan_TTD_v6';
function toggleDriverName(){
  const sel=document.getElementById('driver');
  const wrap=document.getElementById('driverNameWrap');
  const input=document.getElementById('nama_pengemudi');
  if(sel.value==='Dengan Pengemudi'){ wrap.classList.remove('hidden'); }
  else{ wrap.classList.add('hidden'); input.value=''; }
}
document.getElementById('driver').addEventListener('change', toggleDriverName);

function serialize(){
  const data={};
  document.querySelectorAll('input,textarea,select').forEach(el=>{
    if(el.type==='checkbox') data[el.name]=el.checked;
    else if(el.type==='radio'){ if(el.checked) data[el.name]=el.value; }
    else data[el.name]=el.value;
  });
  ['sig_peminjam','sig_pic','sig_mengetahui'].forEach(id=>{
    const c=document.getElementById(id);
    if(c && c._dirty) data[id]=c.toDataURL();
  });
  return data;
}
function fill(d){
  Object.entries(d||{}).forEach(([k,v])=>{
    const el=document.querySelector('[name="'+k+'"]');
    if(el){el.value=v;}
    if(['sig_peminjam','sig_pic','sig_mengetahui'].includes(k)){
      const c=document.getElementById(k);
      if(c && v){const ctx=c.getContext('2d');const img=new Image();img.onload=()=>ctx.drawImage(img,0,0,c.width,c.height);img.src=v;}
    }
  });
  toggleDriverName();
}
document.getElementById('btnSimpan').onclick=()=>{localStorage.setItem(storageKey,JSON.stringify(serialize()));alert('Tersimpan');};
document.getElementById('btnMuat').onclick=()=>{const d=localStorage.getItem(storageKey);if(d) fill(JSON.parse(d));};
document.getElementById('btnBersihkan').onclick=()=>{if(confirm('Bersihkan?')) location.reload();};
document.getElementById('btnPDF').onclick=()=>{window.print();};

function initCanvas(id){
  const c=document.getElementById(id);const ctx=c.getContext('2d');
  c.width=c.clientWidth;c.height=c.clientHeight;
  let draw=false,last=null;
  function pos(e){const r=c.getBoundingClientRect();if(e.touches)e=e.touches[0];return{x:e.clientX-r.left,y:e.clientY-r.top};}
  function line(p1,p2){ctx.lineWidth=2;ctx.lineCap='round';ctx.beginPath();ctx.moveTo(p1.x,p1.y);ctx.lineTo(p2.x,p2.y);ctx.stroke();}
  c.addEventListener('mousedown',e=>{draw=true;last=pos(e);});
  c.addEventListener('mousemove',e=>{if(!draw)return;let p=pos(e);line(last,p);last=p;c._dirty=true;});
  c.addEventListener('mouseup',()=>{draw=false;});c.addEventListener('mouseleave',()=>{draw=false;});
  c.addEventListener('touchstart',e=>{draw=true;last=pos(e);e.preventDefault();});
  c.addEventListener('touchmove',e=>{if(!draw)return;let p=pos(e);line(last,p);last=p;c._dirty=true;e.preventDefault();});
  c.addEventListener('touchend',()=>{draw=false;});
}
['sig_peminjam','sig_pic','sig_mengetahui'].forEach(initCanvas);
document.addEventListener('DOMContentLoaded', ()=>{ toggleDriverName(); });
</script>
</body>
</html>
